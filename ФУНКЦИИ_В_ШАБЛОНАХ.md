# Использование PHP-функций в шаблонах

## Краткая инструкция

Теперь вы можете использовать PHP-функции в своих шаблонах! Ваш шаблонизатор был расширен для поддержки вызова функций.

### Основное использование

```twig
{! vite('app') !}
```

Этот код автоматически компилируется в:
```php
<?= $__tpl->callFunction('vite', 'app') ?? '' ?>
```

## Регистрация функций

### Автоматически зарегистрированные функции

При создании экземпляра `TemplateEngine` автоматически регистрируются следующие функции (если они существуют):

- `vite(entry)` - генерация HTML-тегов для Vite assets
- `vite_asset(entry, type)` - получение URL Vite asset
- `asset(path)` - URL статического ресурса
- `url(path)` - генерация URL
- `route(name, params)` - URL по имени маршрута
- `csrf_token()` - CSRF токен
- `csrf_field()` - HTML поле с CSRF токеном
- `old(key, default)` - старое значение формы
- `config(key, default)` - значение конфигурации
- `env(key, default)` - переменная окружения
- `trans(key, params)` - перевод строки

### Регистрация собственных функций

```php
use Core\TemplateEngine;

$template = TemplateEngine::getInstance();

// Простая функция
$template->addFunction('greeting', function() {
    return 'Привет!';
});

// Функция с параметрами
$template->addFunction('hello', function($name) {
    return "Привет, {$name}!";
});

// Функция с несколькими параметрами
$template->addFunction('format_price', function($price, $currency = 'USD') {
    return number_format($price, 2) . ' ' . $currency;
});
```

## Примеры использования в шаблонах

### Без аргументов
```twig
{! greeting() !}
```

### С строковым аргументом
```twig
{! hello("Иван") !}
```

### С переменной
```twig
{! hello(username) !}
```

### С несколькими аргументами
```twig
{! format_price(100.50, "RUB") !}
```

### Вложенные вызовы
```twig
{! upper(hello(username)) !}
```

### В условиях
```twig
{% if is_admin() %}
    <div class="admin-panel">Панель администратора</div>
{% endif %}
```

### В экранированном выводе
```twig
<!-- Результат будет экранирован (безопасно для HTML) -->
{{ make_html_tag() }}
```

### В неэкранированном выводе
```twig
<!-- Результат НЕ будет экранирован (используйте осторожно!) -->
{! vite('app') !}
```

## Пример: использование vite()

### В layout.twig
```twig
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    
    {! vite('app') !}
</head>
<body>
    {% block content %}{% endblock %}
</body>
</html>
```

### Результат в development режиме
```html
<script type="module" src="http://localhost:5173/@vite/client"></script>
<script type="module" src="http://localhost:5173/resources/js/app.js"></script>
```

### Результат в production режиме
```html
<link rel="stylesheet" href="/build/assets/app-abc123.css">
<script type="module" src="/build/assets/app-def456.js"></script>
```

## Проверка существования функции

```php
if ($template->hasFunction('vite')) {
    echo "Функция vite зарегистрирована";
}
```

## Важные замечания

1. **Безопасность**: Используйте `{! !}` только для доверенного HTML-контента
2. **Экранирование**: Используйте `{{ }}` для обычного текста (автоматически экранируется)
3. **Регистрация**: Функции должны быть зарегистрированы до рендеринга шаблона
4. **Производительность**: Функции вызываются при каждом рендеринге шаблона

## Дополнительная информация

Полная документация доступна в файле `docs/TemplateEngine.md`.

