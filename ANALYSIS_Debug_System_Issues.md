# üîç –ê–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –¥–µ–±–∞–≥–∞ - –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 1 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** TorrentPier  
**–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** Debug System, Memory Profiler, Debug Toolbar, Debug Timer

---

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—Ü–µ–Ω–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
- ‚úÖ **Debug Core** - 8/10 (—Ö–æ—Ä–æ—à–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- ‚ö†Ô∏è **Memory Profiler** - 6/10 (–µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã)
- ‚úÖ **Debug Timer** - 9/10 (–æ—Ç–ª–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- ‚úÖ **Debug Toolbar** - 9/10 (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- ‚ö†Ô∏è **AbstractCollector** - 5/10 (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞)

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é –≤ `MemoryProfiler::current()` –∏ `peak()`

**–§–∞–π–ª:** `core/MemoryProfiler.php:66-76`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
public static function current(): int
{
    return memory_get_usage(false);  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
}

public static function peak(): int
{
    return memory_get_peak_usage(false);  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
- `memory_get_usage(false)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å**, –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º–æ–π (–≤–∫–ª—é—á–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã PHP)
- `memory_get_usage(true)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –ø–∞–º—è—Ç—å**, –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é –≤–∞—à–∏–º —Å–∫—Ä–∏–ø—Ç–æ–º
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ PHP —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `memory_get_usage(true)` –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
1. –ù–µ—Ç–æ—á–Ω—ã–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
2. –ó–∞–≤—ã—à–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –∏–∑-–∑–∞ —É—á–µ—Ç–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä PHP
3. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
4. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã diff –º–µ–∂–¥—É —Å–Ω–∏–º–∫–∞–º–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```php
public static function current(): int
{
    return memory_get_usage(true);  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º true –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
}

public static function peak(): int
{
    return memory_get_peak_usage(true);  // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º true –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
}
```

**–¢–∞–∫–∂–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
```php
// –°—Ç—Ä–æ–∫–∞ 19
self::$startMemory = memory_get_usage(true);

// –°—Ç—Ä–æ–∫–∞ 34
$current = memory_get_usage(true);

// –°—Ç—Ä–æ–∫–∞ 35
$peak = memory_get_peak_usage(true);

// –°—Ç—Ä–æ–∫–∞ 113
$current = memory_get_usage(true);

// –°—Ç—Ä–æ–∫–∞ 114
$peak = memory_get_peak_usage(true);

// –°—Ç—Ä–æ–∫–∞ 198
$before = memory_get_usage(true);

// –°—Ç—Ä–æ–∫–∞ 204
$after = memory_get_usage(true);

// –°—Ç—Ä–æ–∫–∞ 282
$current = memory_get_usage(true);
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô

---

### 2. ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–π—Ç–æ–≤

**–§–∞–π–ª—ã:** 
- `core/MemoryProfiler.php:228-242` 
- `core/DebugToolbar/AbstractCollector.php:75-84`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–î–≤–µ —Ä–∞–∑–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–π—Ç–æ–≤:

```php
// MemoryProfiler
public static function formatBytes(int $bytes, int $precision = 2): string
{
    if ($bytes === 0) {
        return '0 B';
    }

    $bytes = abs($bytes);
    $units = ['B', 'KB', 'MB', 'GB', 'TB'];
    $pow = floor(log($bytes) / log(1024));
    $pow = min($pow, count($units) - 1);

    $value = $bytes / pow(1024, $pow);
    return number_format($value, $precision) . ' ' . $units[$pow];
}

// AbstractCollector
protected function formatBytes(int $bytes): string
{
    $units = ['B', 'KB', 'MB', 'GB'];
    $i = 0;
    while ($bytes >= 1024 && $i < count($units) - 1) {
        $bytes /= 1024;
        $i++;
    }
    return round($bytes, 2) . ' ' . $units[$i];
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–†–∞–∑–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è**: MemoryProfiler –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç TB, AbstractCollector - –Ω–µ—Ç
2. **–†–∞–∑–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å**: MemoryProfiler –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `number_format()`, AbstractCollector - `round()`
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ 0**: MemoryProfiler –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 0, AbstractCollector - –Ω–µ—Ç
4. **DRY –Ω–∞—Ä—É—à–µ–Ω**: –∫–æ–¥ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ —Ä–∞–∑–Ω—ã—Ö —á–∞—Å—Ç—è—Ö Debug Toolbar
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—É—é —É—Ç–∏–ª–∏—Ç—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```php
// core/Utils/FormatHelper.php
class FormatHelper
{
    public static function formatBytes(int $bytes, int $precision = 2): string
    {
        if ($bytes === 0) {
            return '0 B';
        }

        $bytes = abs($bytes);
        $units = ['B', 'KB', 'MB', 'GB', 'TB', 'PB'];
        $pow = floor(log($bytes) / log(1024));
        $pow = min($pow, count($units) - 1);

        $value = $bytes / pow(1024, $pow);
        return number_format($value, $precision) . ' ' . $units[$pow];
    }
}
```

–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –≤–µ–∑–¥–µ:
```php
// MemoryProfiler
public static function formatBytes(int $bytes, int $precision = 2): string
{
    return \Core\Utils\FormatHelper::formatBytes($bytes, $precision);
}

// AbstractCollector
protected function formatBytes(int $bytes): string
{
    return \Core\Utils\FormatHelper::formatBytes($bytes, 2);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† –í–´–°–û–ö–ò–ô

---

### 3. ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å getMemoryLimit() –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

**–§–∞–π–ª:** `core/MemoryProfiler.php:247-269`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
public static function getMemoryLimit(): int
{
    $limit = ini_get('memory_limit');

    if ($limit === '-1') {
        return 0; // –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ
    }

    $limit = trim($limit);
    $last = strtolower($limit[strlen($limit) - 1]);  // ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞
    $value = (int)$limit;

    switch ($last) {
        case 'g':
            $value *= 1024;
        case 'm':
            $value *= 1024;
        case 'k':
            $value *= 1024;
    }

    return $value;
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É**: –µ—Å–ª–∏ `$limit` –ø—É—Å—Ç–æ–π, `$limit[strlen($limit) - 1]` –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É
2. **–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤**: –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è, —Ñ—É–Ω–∫—Ü–∏—è –º–æ–ª—á–∞ –≤–µ—Ä–Ω—ë—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ break –≤ switch**: —ç—Ç–æ intentional (fallthrough), –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```php
public static function getMemoryLimit(): int
{
    $limit = ini_get('memory_limit');

    if ($limit === '-1' || $limit === false) {
        return 0; // –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ –∏–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ
    }

    $limit = trim($limit);
    
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
    if (empty($limit)) {
        return 0;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å—É—Ñ—Ñ–∏–∫—Å
    if (!preg_match('/^(\d+)([KMG])?$/i', $limit, $matches)) {
        return 0; // –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    }

    $value = (int)$matches[1];
    $suffix = strtolower($matches[2] ?? '');

    switch ($suffix) {
        case 'g':
            $value *= 1024;
            // fallthrough intentional
        case 'm':
            $value *= 1024;
            // fallthrough intentional
        case 'k':
            $value *= 1024;
            break;
    }

    return $value;
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô

---

### 4. ‚ö†Ô∏è –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ parseMemoryLimit() –≤ MemoryCollector

**–§–∞–π–ª:** `core/DebugToolbar/Collectors/MemoryCollector.php:119-134`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ memory_limit –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ `MemoryCollector::parseMemoryLimit()`.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `MemoryProfiler::getMemoryLimit()` –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:

```php
private function getMemoryLimit(): int
{
    return MemoryProfiler::getMemoryLimit();
}

// –£–¥–∞–ª–∏—Ç—å parseMemoryLimit()
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô

---

## ‚ö†Ô∏è –ó–ù–ê–ß–ò–¢–ï–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 5. ‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤ AbstractCollector::formatTime()

**–§–∞–π–ª:** `core/DebugToolbar/AbstractCollector.php:89-95`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```php
protected function formatTime(float $time): string
{
    if ($time < 1) {
        return number_format($time * 1000, 2) . 'Œºs';  // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
    }
    return number_format($time, 2) . 'ms';
}
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
- –ï—Å–ª–∏ `$time < 1` –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã, —É–º–Ω–æ–∂–µ–Ω–∏–µ –Ω–∞ 1000 –¥–∞—ë—Ç **–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã**
- –ù–æ —Å—É—Ñ—Ñ–∏–∫—Å 'Œºs' –æ–∑–Ω–∞—á–∞–µ—Ç –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã, –∞ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –µ–¥–∏–Ω–∏—Ü—É
- –õ–æ–≥–∏–∫–∞ –Ω–µ–ø–æ–Ω—è—Ç–Ω–∞: –≤—Ö–æ–¥–Ω–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö –∏–ª–∏ —Å–µ–∫—É–Ω–¥–∞—Ö?

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
- –ü—É—Ç–∞–Ω–∏—Ü–∞ —Å –µ–¥–∏–Ω–∏—Ü–∞–º–∏ –∏–∑–º–µ—Ä–µ–Ω–∏—è

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–ù—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≤ –∫–∞–∫–∏—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è `$time`. –ï—Å–ª–∏ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö:

```php
protected function formatTime(float $timeMs): string
{
    if ($timeMs < 1) {
        // –ú–µ–Ω—å—à–µ 1 –º—Å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥–∞—Ö
        return number_format($timeMs * 1000, 2) . ' Œºs';
    } elseif ($timeMs < 1000) {
        // –ú–µ–Ω—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        return number_format($timeMs, 2) . ' ms';
    } else {
        // –ë–æ–ª—å—à–µ 1 —Å–µ–∫—É–Ω–¥—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        return number_format($timeMs / 1000, 2) . ' s';
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† –í–´–°–û–ö–ò–ô

---

### 6. üìù –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ $real_usage –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö –ø–∞–º—è—Ç–∏

**–§–∞–π–ª:** `core/MemoryProfiler.php`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –æ —Ç–æ–º, –ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `false` –≤ `memory_get_usage(false)` –∏ —á—Ç–æ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å PHPDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:

```php
/**
 * –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
 * 
 * @return int –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ –≤ –±–∞–π—Ç–∞—Ö (—Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –≤–∫–ª—é—á–∞—è –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã PHP)
 * 
 * @see memory_get_usage() —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º true –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
 */
public static function current(): int
{
    return memory_get_usage(true);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô

---

### 7. üîí –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –≤ Debug::dump()

**–§–∞–π–ª:** `core/Debug.php:17-47`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å–ª–∏ –≤ –æ–±—ä–µ–∫—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –¥–∞–º–ø–∏—Ç—Å—è, –µ—Å—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ Debug (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –ª–æ–≥–≥–µ—Ä), –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏—è.

**–¢–µ–∫—É—â–∞—è –∑–∞—â–∏—Ç–∞:**
```php
// –ï—Å—Ç—å –∑–∞—â–∏—Ç–∞ –≤ varToString() —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º $objectHashes
// –ù–æ –æ–Ω–∞ –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –≤—ã–∑–æ–≤–∞ dump() –≤–Ω—É—Ç—Ä–∏ dump()
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ä–µ–∫—É—Ä—Å–∏–∏:

```php
private static bool $isDumping = false;

public static function dump(mixed $var, ?string $label = null, bool $die = false): void
{
    // –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
    if (self::$isDumping) {
        return;
    }

    self::$isDumping = true;

    try {
        $backtrace = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, 1);
        // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ ...
    } finally {
        self::$isDumping = false;
    }
    
    if ($die) {
        self::flush();
        exit;
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° –°–†–ï–î–ù–ò–ô

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### 8. üìà –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å–∞–º–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–µ–±–∞–≥–∞:

```php
class DebugMetrics
{
    private static float $totalDebugTime = 0.0;
    private static int $totalDebugMemory = 0;

    public static function measureDebugOperation(callable $callback): mixed
    {
        $startTime = microtime(true);
        $startMemory = memory_get_usage(true);

        $result = $callback();

        self::$totalDebugTime += (microtime(true) - $startTime);
        self::$totalDebugMemory += (memory_get_usage(true) - $startMemory);

        return $result;
    }

    public static function getMetrics(): array
    {
        return [
            'debug_overhead_time' => self::$totalDebugTime,
            'debug_overhead_memory' => self::$totalDebugMemory,
        ];
    }
}
```

---

### 9. üß™ –£–ª—É—á—à–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ï—Å—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `MemoryProfiler`
- ‚úÖ –ï—Å—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è `DebugTimer`
- ‚ö†Ô∏è –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ `memory_limit`
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –ø–∞–º—è—Ç–∏ (> 1TB)
3. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
4. –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã

---

### 10. üìä –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–Ω–∏–º–∫–æ–≤ –ø–∞–º—è—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏:

```php
class MemoryHistory
{
    private static string $historyFile = '/tmp/memory_history.json';

    public static function saveSnapshot(array $snapshot): void
    {
        $history = self::loadHistory();
        $history[] = [
            'timestamp' => time(),
            'url' => $_SERVER['REQUEST_URI'] ?? 'cli',
            'snapshot' => $snapshot,
        ];

        // –•—Ä–∞–Ω–∏–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 –∑–∞–ø–∏—Å–µ–π
        $history = array_slice($history, -100);
        file_put_contents(self::$historyFile, json_encode($history));
    }
}
```

---

### 11. üé® –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≥—Ä–∞—Ñ–∏–∫–æ–≤ –ø–∞–º—è—Ç–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í Debug Toolbar –¥–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏:

```php
class MemoryChart
{
    public static function renderChart(array $snapshots): string
    {
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SVG –≥—Ä–∞—Ñ–∏–∫–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Chart.js
        // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–æ—Å—Ç/–ø–∞–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –º–µ–∂–¥—É —Å–Ω–∏–º–∫–∞–º–∏
    }
}
```

---

### 12. üîî –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```php
class MemoryAlerts
{
    public static function checkThresholds(): void
    {
        $usage = MemoryProfiler::getUsagePercentage();
        
        if ($usage > 90) {
            Logger::critical("Memory usage critical: {$usage}%");
        } elseif ($usage > 75) {
            Logger::warning("Memory usage high: {$usage}%");
        }
    }
}
```

---

## üìã –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `memory_get_usage(false)` –Ω–∞ `memory_get_usage(true)` –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `formatBytes()`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í—ã—Å–æ–∫–∏–π - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):
3. ‚úÖ –£–ª—É—á—à–∏—Ç—å `getMemoryLimit()` —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `formatTime()` –≤ AbstractCollector
5. ‚úÖ –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ `parseMemoryLimit()`

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°—Ä–µ–¥–Ω–∏–π - —É–ª—É—á—à–µ–Ω–∏—è):
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ä–µ–∫—É—Ä—Å–∏–∏ –≤ `Debug::dump()`
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
8. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4 (–ù–∏–∑–∫–∏–π - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
9. ‚ö™ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–µ–±–∞–≥–∞
10. ‚ö™ –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–Ω–∏–º–∫–æ–≤
11. ‚ö™ –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –≥—Ä–∞—Ñ–∏–∫–æ–≤
12. ‚ö™ –î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã

---

## üéØ –í–´–í–û–î–´

### ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:
1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Debug Toolbar** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è, —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–æ–≤
2. **Debug Timer** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `varToString()`
4. **–¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** - —Ö–æ—Ä–æ—à–µ–µ –±–∞–∑–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
5. **Middleware –ø–æ–¥—Ö–æ–¥** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ Debug Toolbar —á–µ—Ä–µ–∑ middleware

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. **Memory API** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `false` –≤–º–µ—Å—Ç–æ `true` –≤ `memory_get_usage()`
2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - `formatBytes()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–≤–∞–∂–¥—ã –ø–æ-—Ä–∞–∑–Ω–æ–º—É
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** - `getMemoryLimit()` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞
4. **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - —Ä–∞–∑–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### üí° –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:
**7.5/10** - –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –∏–∑–º–µ—Ä–µ–Ω–∏–π –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å.

---

**–ê–≤—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∞:** AI Assistant  
**–î–∞—Ç–∞:** 1 –æ–∫—Ç—è–±—Ä—è 2025

