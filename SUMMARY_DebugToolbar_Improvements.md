# üéâ –£–ª—É—á—à–µ–Ω–∏–µ Debug Toolbar Middleware - –ì–æ—Ç–æ–≤–æ!

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–£–ª—É—á—à–µ–Ω `DebugToolbarMiddleware`**
   - –£–ø—Ä–æ—â–µ–Ω–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –ª–æ–≥–∏–∫–∞
   - –î–æ–±–∞–≤–ª–µ–Ω —Ä–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ –¥–ª—è production (0 –æ–≤–µ—Ä—Ö–µ–¥–∞)
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–µ—Ç–æ–¥—ã —Å —á–µ—Ç–∫–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

2. **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞**
   - Debug Toolbar —Ç–µ–ø–µ—Ä—å –∏–Ω—ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –≤ middleware
   - Response –∏ TemplateEngine –±–æ–ª—å—à–µ –Ω–µ –∑–Ω–∞—é—Ç –æ toolbar
   - –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

3. **–î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - `docs/DebugToolbarMiddleware_Improvements.md` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
   - `docs/CHANGELOG_DebugToolbar_Improvements.md` - changelog
   - –û–±–Ω–æ–≤–ª–µ–Ω `docs/DebugToolbarMiddleware.md`

4. **–ù–∞–ø–∏—Å–∞–Ω—ã Unit —Ç–µ—Å—Ç—ã**
   - `tests/Unit/Core/Middleware/DebugToolbarMiddlewareTest.php`
   - –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–¥
- ‚úèÔ∏è `core/Middleware/DebugToolbarMiddleware.php` - –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úèÔ∏è `docs/DebugToolbarMiddleware.md` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã
- ‚ûï `docs/DebugToolbarMiddleware_Improvements.md` - –Ω–æ–≤—ã–π —Ñ–∞–π–ª
- ‚ûï `docs/CHANGELOG_DebugToolbar_Improvements.md` - –Ω–æ–≤—ã–π —Ñ–∞–π–ª
- ‚ûï `SUMMARY_DebugToolbar_Improvements.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### –¢–µ—Å—Ç—ã
- ‚ûï `tests/Unit/Core/Middleware/DebugToolbarMiddlewareTest.php` - –Ω–æ–≤—ã–π —Ñ–∞–π–ª

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–æ –∏ –ø–æ—Å–ª–µ

### ‚ùå –î–æ (–±—ã–ª–æ –ø—Ä–æ–±–ª–µ–º–æ–π)
```
TemplateEngine::display()
  ‚Üì —Ä–µ–Ω–¥–µ—Ä–∏—Ç toolbar (–∫–æ—Å—Ç—ã–ª—å)
  ‚Üì
Response::send()
  ‚Üì —Ä–µ–Ω–¥–µ—Ä–∏—Ç toolbar (–∫–æ—Å—Ç—ã–ª—å)
  ‚Üì
DebugToolbarMiddleware
  ‚Üì —Ç–æ–∂–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```
**–ü—Ä–æ–±–ª–µ–º—ã:** –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–∞—Ä—É—à–µ–Ω–∏–µ SRP, —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –ü–æ—Å–ª–µ (—á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
```
Response::send()
  ‚Üì echo HTML (—Ç–æ–ª—å–∫–æ —Å–≤–æ—è —Ä–∞–±–æ—Ç–∞)
  ‚Üì
DebugToolbarMiddleware
  ‚Üì –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ (ob_start)
  ‚Üì –∏–Ω—ä–µ–∫—Ç–∏—Ä—É–µ—Ç toolbar
  ‚Üì echo –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML
  ‚Üì
Browser
```
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –µ–¥–∏–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å, –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, —á–∏—Å—Ç—ã–π –∫–æ–¥

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Production —Ä–µ–∂–∏–º
```php
if (!Environment::isDebug()) {
    return $next(); // –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥
}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 0 –æ–≤–µ—Ä—Ö–µ–¥–∞! ‚ú®

### Development —Ä–µ–∂–∏–º
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–≤–µ—Ä—Ö–µ–¥ –æ—Ç output buffering
- –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –≤–ª–∏—è–Ω–∏–µ, –ø—Ä–∏–µ–º–ª–µ–º–æ–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## ‚ú® –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –≤–æ–∑–º–æ–∂–Ω–æ

1. **–ß–∏—Å—Ç—ã–π –∫–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤**
   ```php
   public function index(): Response
   {
       return $this->view('home'); // Toolbar –¥–æ–±–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   }
   ```

2. **–õ–µ–≥–∫–æ –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å**
   ```php
   // config/middleware.php
   'global' => [
       // –ü—Ä–æ—Å—Ç–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ–±—ã –æ—Ç–∫–ª—é—á–∏—Ç—å
       \Core\Middleware\DebugToolbarMiddleware::class,
   ],
   ```

3. **–ù–µ –ª–æ–º–∞–µ—Ç API endpoints**
   ```php
   public function api(): Response
   {
       return $this->json(['data' => $data]); // Toolbar –ù–ï –¥–æ–±–∞–≤–∏—Ç—Å—è
   }
   ```

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ toolbar –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–∞–¥–∞–µ—Ç
   - –í production toolbar –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–µ–Ω

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π
üìñ [docs/DebugToolbarMiddleware_Improvements.md](docs/DebugToolbarMiddleware_Improvements.md)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –¥–æ/–ø–æ—Å–ª–µ
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
- Unit —Ç–µ—Å—Ç—ã

### Changelog
üìã [docs/CHANGELOG_DebugToolbar_Improvements.md](docs/CHANGELOG_DebugToolbar_Improvements.md)
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- Breaking changes (–Ω–µ—Ç!)
- Migration guide (–Ω–µ –Ω—É–∂–µ–Ω!)

### –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
üìò [docs/DebugToolbarMiddleware.md](docs/DebugToolbarMiddleware.md)
- –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å middleware
- –ü—Ä–∏–º–µ—Ä—ã
- FAQ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã middleware
./vendor/bin/pest tests/Unit/Core/Middleware/

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã Debug Toolbar Middleware
./vendor/bin/pest tests/Unit/Core/Middleware/DebugToolbarMiddlewareTest.php
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ Production/Development —Ä–µ–∂–∏–º—ã
- ‚úÖ HTML/JSON Content-Type
- ‚úÖ Output buffering
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Response

## ‚ö†Ô∏è Breaking Changes

**–ù–ï–¢!** –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

–í–µ—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

## üéì Lessons Learned

**–ü—Ä–∏–Ω—Ü–∏–ø:** Middleware ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ output

**–ü–æ—á–µ–º—É:**
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (SRP)
- ‚úÖ –ù–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –¥—Ä—É–≥–∏—Ö –∫–ª–∞—Å—Å–æ–≤ (OCP)
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ –õ–µ–≥–∫–æ –≤–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å
- ‚úÖ –°–ª–µ–¥—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—É middleware

**–ê–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω:**
- ‚ùå –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è output –≤ Response::send()
- ‚ùå –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è output –≤ TemplateEngine::display()
- ‚ùå –†–∞–∑–º–∞–∑–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–æ —Ä–∞–∑–Ω—ã–º –∫–ª–∞—Å—Å–∞–º

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å:
- ‚úÖ –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- ‚úÖ –ù—É–ª–µ–≤–æ–π –æ–≤–µ—Ä—Ö–µ–¥ –≤ production
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**Debug Toolbar —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –±–µ–∑ –∫–æ—Å—Ç—ã–ª–µ–π!** üöÄ

---

## üìû –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `APP_ENV=development` –≤ `.env`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. Debug Toolbar –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –ò–∑—É—á–∏—Ç–µ –∫–æ–¥
–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —É–ª—É—á—à–µ–Ω–Ω—ã–π `core/Middleware/DebugToolbarMiddleware.php`
- –ü—Ä–æ—Å—Ç–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞
- –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã
```bash
./vendor/bin/pest tests/Unit/Core/Middleware/DebugToolbarMiddlewareTest.php
```

### –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [DebugToolbarMiddleware_Improvements.md](docs/DebugToolbarMiddleware_Improvements.md)
- [CHANGELOG_DebugToolbar_Improvements.md](docs/CHANGELOG_DebugToolbar_Improvements.md)

---

**Enjoy your clean architecture!** üé®‚ú®

*–°–æ–∑–¥–∞–Ω–æ AI Assistant | 2025-10-01*

