# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

> ‚ö†Ô∏è **–£–°–¢–ê–†–ï–õ–û**: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥.  
> –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è: [ZeroFilesystemChecks.md](ZeroFilesystemChecks.md)

## üìä –û–±–∑–æ—Ä

~~–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–æ–∫ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (`is_dir()`, `mkdir()`, `file_exists()`) –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞. –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏–∑ "–≥–æ—Ä—è—á–∏—Ö" —É—á–∞—Å—Ç–∫–æ–≤ –∫–æ–¥–∞ (–≤—ã–∑—ã–≤–∞–µ–º—ã—Ö –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ) –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.~~

**–ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `is_dir()` –∏ `mkdir()` –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞–Ω—ã. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ —á–µ—Ä–µ–∑ `php artisan storage:setup`. –°–º. [ZeroFilesystemChecks.md](ZeroFilesystemChecks.md)

## ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. **Logger/FileHandler.php**

**–ë—ã–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –∏ `mkdir()` –ø—Ä–∏ **–∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏** –≤ –ª–æ–≥
```php
public function handle(string $level, string $message): void
{
    $dir = dirname($this->file);
    if (!is_dir($dir)) {
        mkdir($dir, 0755, true);
    }
    // ...–∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
}
```

**–°—Ç–∞–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–±—Ä–∞–Ω–∞, –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ `Core::initDebugSystem()`
```php
public function handle(string $level, string $message): void
{
    // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –≤ Core::initDebugSystem()
    // –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª–µ–Ω–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    $entry = sprintf("[%s] [%s] %s%s", date('Y-m-d H:i:s'), strtoupper($level), $message, PHP_EOL);
    file_put_contents($this->file, $entry, FILE_APPEND);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò—Å–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Å–æ—Ç–Ω–∏ —Ä–∞–∑ –∑–∞ –∑–∞–ø—Ä–æ—Å).

---

### 2. **Cache/Drivers/FileDriver.php**

**–ë—ã–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –ø—Ä–∏ **–∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ** `set()`
```php
public function set(string $key, mixed $value, ...): bool
{
    $dir = dirname($file);
    if (!is_dir($dir) && !mkdir($dir, 0755, true) && !is_dir($dir)) {
        return false;
    }
    // ...—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
}
```

**–°—Ç–∞–ª–æ:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ –ø–∞–º—è—Ç–∏
```php
protected array $createdDirs = []; // –ö—ç—à —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

public function set(string $key, mixed $value, ...): bool
{
    $dir = dirname($file);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –µ—â–µ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –≤ —ç—Ç–æ–π —Å–µ—Å—Å–∏–∏
    if (!isset($this->createdDirs[$dir])) {
        if (!is_dir($dir)) {
            if (!mkdir($dir, 0755, true) && !is_dir($dir)) {
                return false;
            }
        }
        $this->createdDirs[$dir] = true; // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º
    }
    // ...—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫—ç—à–∞. –ü—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫—ç—à–∞ —ç—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç —Ç—ã—Å—è—á–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.

---

### 3. **Emailer/Drivers/LogDriver.php**

**–ë—ã–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –ø—Ä–∏ **–∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ** email
```php
public function send(EmailMessage $message): bool
{
    $dir = dirname($this->logFile);
    if (!is_dir($dir)) {
        mkdir($dir, 0755, true);
    }
    // ...–∑–∞–ø–∏—Å—å email –≤ –ª–æ–≥
}
```

**–°—Ç–∞–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
```php
public function __construct(array $config)
{
    $this->logFile = $config['path'] ?? LOG_DIR . '/emails.log';
    
    // –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –æ–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
    $dir = dirname($this->logFile);
    if (!is_dir($dir)) {
        mkdir($dir, 0755, true);
    }
}

public function send(EmailMessage $message): bool
{
    // –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ
    file_put_contents($this->logFile, $logEntry . PHP_EOL . PHP_EOL, FILE_APPEND);
    // ...
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ –≤–º–µ—Å—Ç–æ –∫–∞–∂–¥–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏.

---

### 4. **DumpClient.php**

**–ë—ã–ª–æ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –ø—Ä–∏ **–∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ** `dump()`
```php
private static function logToFile(array $payload): void
{
    $logDir = STORAGE_DIR . '/logs';
    if (!is_dir($logDir)) {
        mkdir($logDir, 0755, true);
    }
    // ...–∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
}
```

**–°—Ç–∞–ª–æ:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å –ø–æ–º–æ—â—å—é —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ñ–ª–∞–≥–∞
```php
private static bool $logDirChecked = false;

private static function logToFile(array $payload): void
{
    $logDir = STORAGE_DIR . '/logs';
    
    // –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –æ–¥–∏–Ω —Ä–∞–∑ (–∫—ç—à–∏—Ä—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É)
    if (!self::$logDirChecked) {
        if (!is_dir($logDir)) {
            mkdir($logDir, 0755, true);
        }
        self::$logDirChecked = true;
    }
    // ...–∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –≤–µ—Å—å lifecycle –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---

## üéØ –û—Å—Ç–∞–≤–ª–µ–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–°–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ **–æ—Å—Ç–∞–≤–ª–µ–Ω—ã**, —Ç–∞–∫ –∫–∞–∫ –≤—ã–∑—ã–≤–∞—é—Ç—Å—è —Ä–µ–¥–∫–æ:

### 1. **Router.php** - `saveCache()`
–ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫—ç—à–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 1 —Ä–∞–∑ –ø—Ä–∏ `php artisan route:cache`).

### 2. **Config.php** - `cache()`
–ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫—ç—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 1 —Ä–∞–∑ –≤ production).

### 3. **Console/Commands/BaseMakeCommand.php** - `createFile()`
–ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–¥–∫–æ, —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).

### 4. **TemplateEngine.php** - –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
–ü—Ä–æ–≤–µ—Ä–∫–∞ `is_dir()` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞ (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è 1 —Ä–∞–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Å—Ç–∞–Ω—Å–∞).

---

## üìà –û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ß–∞—Å—Ç–æ—Ç–∞ –≤—ã–∑–æ–≤–æ–≤ | –≠–∫–æ–Ω–æ–º–∏—è –Ω–∞ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-----------|-----------------|---------------------------|-----------|
| **Logger** | ~100-500/–∑–∞–ø—Ä–æ—Å | ~100-500 `is_dir()` | üî• –í—ã—Å–æ–∫–∏–π |
| **Cache** | ~10-100/–∑–∞–ø—Ä–æ—Å | ~10-100 `is_dir()` | üî• –í—ã—Å–æ–∫–∏–π |
| **EmailDriver** | ~0-10/–∑–∞–ø—Ä–æ—Å | ~0-10 `is_dir()` | üü° –°—Ä–µ–¥–Ω–∏–π |
| **DumpClient** | ~0-20/–∑–∞–ø—Ä–æ—Å (dev) | ~0-20 `is_dir()` | üü¢ –ù–∏–∑–∫–∏–π |

**–û–±—â–∞—è —ç–∫–æ–Ω–æ–º–∏—è:** –î–æ **620 —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤** –Ω–∞ 1000 HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.

---

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã, —Ç–∞–∫ –∫–∞–∫:

1. **–ë–∞–∑–æ–≤—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** (`LOG_DIR`, `CACHE_DIR`) —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ `Core::init()`
2. **–ö—ç—à –ø—Ä–æ–≤–µ—Ä–æ–∫** —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
3. **Race conditions** –∏—Å–∫–ª—é—á–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `mkdir(..., true)` (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ)
4. **Fallback –ø—Ä–æ–≤–µ—Ä–∫–∏** –æ—Å—Ç–∞–ª–∏—Å—å –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

1. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
2. ‚úÖ –ö—ç—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ —á–∏—Ç–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
3. ‚úÖ Email-–¥—Ä–∞–π–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
4. ‚úÖ Dump-—Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ dev-—Ä–µ–∂–∏–º–µ

```bash
# –¢–µ—Å—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
php artisan test tests/Unit/LoggerTest.php

# –¢–µ—Å—Ç –∫—ç—à–∞
php artisan test tests/Unit/CacheTest.php

# –¢–µ—Å—Ç —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞
php artisan test tests/Unit/TemplateEngineTest.php
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–í production:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
2. **–ü—Ä–∏ –¥–µ–ø–ª–æ–µ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `php artisan cache:clear` –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫—ç—à–µ–π
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ—à–∏–±–∫–∞–º–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `core/Core.php` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- `core/Logger/FileHandler.php` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ª–æ–≥–æ–≤
- `core/Cache/Drivers/FileDriver.php` - —Ñ–∞–π–ª–æ–≤—ã–π –∫—ç—à-–¥—Ä–∞–π–≤–µ—Ä
- `core/Emailer/Drivers/LogDriver.php` - email-–¥—Ä–∞–π–≤–µ—Ä –¥–ª—è –ª–æ–≥–æ–≤
- `core/DumpClient.php` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è –¥–∞–º–ø–æ–≤

---

**–î–∞—Ç–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** 4 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞:** dev/feat/added-vite

