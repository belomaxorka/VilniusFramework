# ๐๏ธ ะฃะปัััะตะฝะธะต ะฐััะธัะตะบัััั Debug

## ะัะพะฑะปะตะผะฐ: ะัะฑะปะธัะพะฒะฐะฝะธะต ะบะพะดะฐ

### ะัะปะพ

ะ ะบะฐะถะดะพะผ ะผะตัะพะดะต Debug ะบะปะฐััะฐ ะดัะฑะปะธัะพะฒะฐะปะฐัั ะปะพะณะธะบะฐ:

```php
public static function trace(?string $label = null): void
{
    // ... ัะพัะผะธัะพะฒะฐะฝะธะต ะฒัะฒะพะดะฐ ...
    
    if (Environment::isDebug()) {
        // ะะพะฑะฐะฒะปัะตะผ ะฒ ะฑััะตั ะดะปั ะฒัะฒะพะดะฐ
        self::$debugOutput[] = [...];
    } else {
        // ะะพะณะธััะตะผ ะฒ ัะฐะนะป
        Logger::debug($output);
    }
}

public static function dumpAll(bool $die = false): void
{
    // ... ัะพัะผะธัะพะฒะฐะฝะธะต ะฒัะฒะพะดะฐ ...
    
    if (Environment::isDebug()) {
        self::addOutput($output);
    } else {
        Logger::debug($output);
    }
}
```

**ะัะพะฑะปะตะผั:**
- โ ะัะฑะปะธัะพะฒะฐะฝะธะต ะปะพะณะธะบะธ ะฟัะพะฒะตัะบะธ debug ัะตะถะธะผะฐ
- โ ะัะฑะปะธัะพะฒะฐะฝะธะต ะปะพะณะธะบะธ ะปะพะณะธัะพะฒะฐะฝะธั
- โ ะะฐะถะดัะน ะผะตัะพะด ัะตัะฐะตั ัะฐะผ, ะบัะดะฐ ะพัะฟัะฐะฒะปััั ะดะฐะฝะฝัะต
- โ ะกะปะพะถะฝะตะต ะฟะพะดะดะตัะถะธะฒะฐัั - ะธะทะผะตะฝะตะฝะธั ะฝัะถะฝะพ ะฒะฝะพัะธัั ะฒะตะทะดะต

---

## ะะตัะตะฝะธะต: ะฆะตะฝััะฐะปะธะทะฐัะธั ะฒ addOutput()

### ะกัะฐะปะพ

ะะตัะพะด `addOutput()` ััะฐะป ัะฝะธะฒะตััะฐะปัะฝัะผ - ะพะฝ ัะฐะผ ัะตัะฐะตั, ะบัะดะฐ ะพัะฟัะฐะฒะธัั ะดะฐะฝะฝัะต:

```php
/**
 * ะะพะฑะฐะฒะธัั ะฒัะฒะพะด ะฒ ะฑััะตั ะธะปะธ ะทะฐะปะพะณะธัะพะฒะฐัั
 * 
 * @param string $output HTML ะฒัะฒะพะด ะดะปั ะฑัะฐัะทะตัะฐ
 * @param string $type ะขะธะฟ ะฒัะฒะพะดะฐ (dump, trace, collect, etc.)
 * @param string|null $label ะะตัะบะฐ ะดะปั ะปะพะณะธัะพะฒะฐะฝะธั
 * @param string|null $rawText ะขะตะบััะพะฒะฐั ะฒะตััะธั ะดะปั ะปะพะณะพะฒ
 */
public static function addOutput(string $output, string $type = 'custom', ?string $label = null, ?string $rawText = null): void
{
    if (!Environment::isDebug()) {
        // ะ ะฟัะพะดะฐะบัะตะฝะต ะปะพะณะธััะตะผ
        if ($rawText !== null) {
            $logOutput = $label ? "[{$label}] {$rawText}" : $rawText;
            Logger::debug($logOutput);
        }
        return;
    }

    // ะ debug ัะตะถะธะผะต ะดะพะฑะฐะฒะปัะตะผ ะฒ ะฑััะตั ะดะปั ะฒัะฒะพะดะฐ
    self::$debugOutput[] = [
        'type' => $type,
        'output' => $output,
        'die' => false
    ];
}
```

---

## ะะฐะบ ัะตะฟะตัั ัะฐะฑะพัะฐะตั

### trace() - ัะฟัะพัะตะฝ

```php
public static function trace(?string $label = null): void
{
    $backtrace = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS);
    array_shift($backtrace);
    
    // ะคะพัะผะธััะตะผ ัะตะบััะพะฒัั ะฒะตััะธั ะดะปั ะปะพะณะพะฒ
    $rawText = "Backtrace:\n";
    foreach ($backtrace as $index => $trace) {
        // ... ัะพัะผะธัะพะฒะฐะฝะธะต ัะตะบััะฐ ...
    }
    
    // ะคะพัะผะธััะตะผ HTML ะดะปั ะฑัะฐัะทะตัะฐ
    $output = '<div>...</div>';
    
    // ะัะฟะพะปัะทัะตะผ ัะฝะธะฒะตััะฐะปัะฝัะน addOutput - ะพะฝ ัะฐะผ ัะตัะธั, ะบัะดะฐ ะพัะฟัะฐะฒะธัั
    self::addOutput($output, 'trace', $label, $rawText);
}
```

**ะัะตะธะผััะตััะฒะฐ:**
- โ ะะพะณะธะบะฐ ะฟัะพะฒะตัะบะธ ัะพะปัะบะพ ะฒ ะพะดะฝะพะผ ะผะตััะต
- โ ะัะพัะต ะบะพะด ะผะตัะพะดะฐ
- โ HTML ะธ ัะตะบัั ัะพัะผะธัััััั ะพัะดะตะปัะฝะพ

### dumpAll() - ัะพะถะต ัะฟัะพัะตะฝ

```php
public static function dumpAll(bool $die = false): void
{
    // ... ัะพัะผะธัะพะฒะฐะฝะธะต HTML ...
    $output .= '</div>';
    
    // ะคะพัะผะธััะตะผ ัะตะบััะพะฒัั ะฒะตััะธั ะดะปั ะปะพะณะพะฒ
    $rawText = "Debug Collection:\n";
    foreach (self::$debugData as $index => $item) {
        // ... ัะพัะผะธัะพะฒะฐะฝะธะต ัะตะบััะฐ ...
    }

    // ะัะฟะพะปัะทัะตะผ ัะฝะธะฒะตััะฐะปัะฝัะน addOutput
    self::addOutput($output, 'dump_all', 'Debug Collection', $rawText);
    
    // ...
}
```

---

## ะััะธัะตะบัััะฐ

### ะะพัะพะบ ะดะฐะฝะฝัั

```
โโโโโโโโโโโโโโโโโโโ
โ  Debug::trace() โ
โ  Debug::dump()  โ
โ Debug::dumpAll()โ
โโโโโโโโโโฌโโโโโโโโโ
         โ
         โ ะคะพัะผะธัััั:
         โ - HTML ะดะปั ะฑัะฐัะทะตัะฐ
         โ - ะขะตะบัั ะดะปั ะปะพะณะพะฒ
         โ - Label
         โ
         v
โโโโโโโโโโโโโโโโโโโโโโ
โ Debug::addOutput() โโโโโโโ ะะดะธะฝะฐั ัะพัะบะฐ ะฟัะธะฝััะธั ัะตัะตะฝะธั
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โ ะัะพะฒะตััะตั Environment::isDebug()
         โ
    โโโโโโดโโโโโ
    โ         โ
    v         v
โโโโโโโ   โโโโโโโโโโ
โDebugโ   โ  Prod  โ
โ on  โ   โ  off   โ
โโโโฌโโโ   โโโโโฌโโโโโ
   โ          โ
   v          v
โโโโโโโโ   โโโโโโโโ
โBufferโ   โLoggerโ
โ ะดะปั  โ   โ ัะฐะนะป โ
โะฒัะฒะพะดะฐโ   โ      โ
โโโโโโโโ   โโโโโโโโ
```

---

## ะัะตะธะผััะตััะฒะฐ ะฝะพะฒะพะณะพ ะฟะพะดัะพะดะฐ

### 1. Single Responsibility
ะะฐะถะดัะน ะผะตัะพะด ะพัะฒะตัะฐะตั ัะพะปัะบะพ ะทะฐ ัะฒะพั ะทะฐะดะฐัั:
- `trace()` - ัะพัะผะธััะตั backtrace
- `dump()` - ัะพัะผะธััะตั ะดะฐะผะฟ ะฟะตัะตะผะตะฝะฝะพะน
- `addOutput()` - ัะตัะฐะตั, ะบัะดะฐ ะพัะฟัะฐะฒะธัั

### 2. DRY (Don't Repeat Yourself)
ะะพะณะธะบะฐ ะฟัะพะฒะตัะบะธ ะธ ะปะพะณะธัะพะฒะฐะฝะธั ะฒ ะพะดะฝะพะผ ะผะตััะต.

### 3. ะะตะณัะต ัะตััะธัะพะฒะฐัั
ะะพะถะฝะพ ัะตััะธัะพะฒะฐัั ัะพัะผะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะพัะดะตะปัะฝะพ ะพั ะปะพะณะธะบะธ ะฒัะฒะพะดะฐ.

### 4. ะะตะณัะต ัะฐััะธัััั
ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะบะฐะฝะฐะปะฐ ะฒัะฒะพะดะฐ (ะฝะฐะฟัะธะผะตั, ะฒ Sentry) - ะธะทะผะตะฝะตะฝะธั ัะพะปัะบะพ ะฒ `addOutput()`.

### 5. ะฃะฝะธัะธะบะฐัะธั
ะัะต ะผะตัะพะดั ัะฐะฑะพัะฐัั ะพะดะธะฝะฐะบะพะฒะพ:
```php
// ะคะพัะผะธััะตะผ ะดะฐะฝะฝัะต
$html = '...';
$text = '...';
$type = 'trace'; // ะธะปะธ 'dump', 'dump_all', etc.
$label = '...';

// ะัะฟัะฐะฒะปัะตะผ
self::addOutput($html, $type, $label, $text);
```

### 6. ะขะธะฟะธะทะฐัะธั ะฒัะฒะพะดะพะฒ
ะะฐะถะดัะน ะฒัะฒะพะด ะธะผะตะตั ัะฒะพะน ัะธะฟ, ััะพ ะฟะพะทะฒะพะปัะตั:
- ะคะธะปัััะพะฒะฐัั ะฟะพ ัะธะฟะฐะผ
- ะะฐะทะปะธัะฐัั ะฒะธะดั ะฒัะฒะพะดะฐ
- ะัะธะผะตะฝััั ัะฐะทะฝัั ะพะฑัะฐะฑะพัะบั

---

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะ ะบะพะดะต ััะตะนะผะฒะพัะบะฐ

```php
// trace() - ะฐะฒัะพะผะฐัะธัะตัะบะธ ะปะพะณะธััะตััั ะฒ prod
Debug::trace('Current Location');

// dumpAll() - ะฐะฒัะพะผะฐัะธัะตัะบะธ ะปะพะณะธััะตััั ะฒ prod
Debug::collect($data1, 'Data 1');
Debug::collect($data2, 'Data 2');
Debug::dumpAll();

// ะะฐััะพะผะฝัะน ะฒัะฒะพะด
$html = '<div>Custom HTML</div>';
$text = 'Custom text for logs';
Debug::addOutput($html, 'custom', 'Custom', $text);
```

### ะ ัะฐะทะฒะธัะธะธ (dev)
- ะัะต ะฒัะฒะพะดะธััั ะฒ ะฑัะฐัะทะตั
- ะัะฐัะธะฒะพะต HTML ัะพัะผะฐัะธัะพะฒะฐะฝะธะต
- Debug Toolbar

### ะ ะฟัะพะดะฐะบัะตะฝะต (prod)
- ะัะต ะปะพะณะธััะตััั ะฒ ัะฐะนะปั
- ะขะตะบััะพะฒัะน ัะพัะผะฐั ะฒ ะปะพะณะฐั
- ะะตะทะพะฟะฐัะฝะพ - ะฝะต ะฒัะฒะพะดะธั ะฝะฐ ัััะฐะฝะธัั

---

## ะะธะณัะฐัะธั

### ะกัะฐััะน ะบะพะด (ะตัะปะธ ะณะดะต-ัะพ ะตััั)

```php
if (Environment::isDebug()) {
    self::$debugOutput[] = [
        'type' => 'custom',
        'output' => $output,
        'die' => false
    ];
} else {
    Logger::debug($output);
}
```

### ะะพะฒัะน ะบะพะด

```php
self::addOutput($htmlOutput, 'trace', $label, $textOutput);
```

---

## ะะปะฐะฝั ะฝะฐ ะฑัะดััะตะต

ะก ัะฐะบะพะน ะฐััะธัะตะบัััะพะน ะปะตะณะบะพ ะดะพะฑะฐะฒะธัั:

1. **ะะฐะทะฝัะต ััะพะฒะฝะธ ะปะพะณะธัะพะฒะฐะฝะธั**
   ```php
   self::addOutput($html, $label, $text, 'error');
   ```

2. **ะะฐะทะฝัะต ะบะฐะฝะฐะปั ะฒัะฒะพะดะฐ**
   ```php
   // ะ config
   'debug' => [
       'channels' => ['browser', 'file', 'sentry']
   ]
   ```

3. **ะคะธะปัััะฐัะธั ะฟะพ ัะธะฟะฐะผ**
   ```php
   // ะฃะถะต ัะตะฐะปะธะทะพะฒะฐะฝะพ! ะขะตะฟะตัั ะผะพะถะฝะพ:
   
   // ะะต ะปะพะณะธัะพะฒะฐัั ะพะฟัะตะดะตะปะตะฝะฝัะต ัะธะฟั ะฒ ะฟัะพะดะฐะบัะตะฝะต
   if (in_array($type, ['trace', 'dump']) && !Environment::isDebug()) {
       return;
   }
   
   // ะะปะธ ะฟัะธะผะตะฝััั ัะฐะทะฝัั ะพะฑัะฐะฑะพัะบั
   match ($type) {
       'trace' => Logger::debug($rawText),
       'dump' => Logger::info($rawText),
       'error' => Logger::error($rawText),
       default => Logger::debug($rawText)
   };
   ```

---

## ะัะพะณะธ

โ **ะะพะด ััะฐะป ัะธัะต** - ะฝะตั ะดัะฑะปะธัะพะฒะฐะฝะธั  
โ **ะะตะณัะต ะฟะพะดะดะตัะถะธะฒะฐัั** - ะธะทะผะตะฝะตะฝะธั ะฒ ะพะดะฝะพะผ ะผะตััะต  
โ **ะะตะณัะต ัะตััะธัะพะฒะฐัั** - ัะฐะทะดะตะปะตะฝะธะต ะพัะฒะตัััะฒะตะฝะฝะพััะธ  
โ **ะะตะณัะต ัะฐััะธัััั** - ะตะดะธะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ  
โ **ะฃะฝะธัะธัะธัะพะฒะฐะฝะพ** - ะฒัะต ะผะตัะพะดั ัะฐะฑะพัะฐัั ะพะดะธะฝะฐะบะพะฒะพ  

**ะััะธัะตะบัััะฐ Debug ััะฐะปะฐ ะปัััะต! ๐๏ธโจ**

---

_ะฃะปัััะตะฝะพ: 2025-10-03_

