# –¢–µ—Å—Ç—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —É—Å–ª–æ–≤–∏—è—Ö Twig

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω—ã comprehensive —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —É—Å–ª–æ–≤–∏—è—Ö `{% if %}`, `{% elseif %}` –∏ `{% while %}`.

## –§–∞–π–ª —Ç–µ—Å—Ç–æ–≤

`tests/Unit/Core/Template/TemplateEngineFiltersInConditionsTest.php`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1. Filters in IF conditions (8 —Ç–µ—Å—Ç–æ–≤)

–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —É—Å–ª–æ–≤–∏—è—Ö:

- ‚úÖ `length` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –º–∞—Å—Å–∏–≤–∞
- ‚úÖ `count` - –ø–æ–¥—Å—á–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- ‚úÖ `upper` - –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –≤–µ—Ä—Ö–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
- ‚úÖ `lower` - –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
- ‚úÖ `trim` - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤
- ‚úÖ `abs` - –∞–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- ‚úÖ `first` - –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
- ‚úÖ `last` - –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç

**–ü—Ä–∏–º–µ—Ä—ã**:
```twig
{% if users|length > 0 %}Has users{% endif %}
{% if name|upper == "JOHN" %}Match{% endif %}
{% if text|trim != "" %}Has text{% endif %}
```

### 2. Multiple filters in IF conditions (4 —Ç–µ—Å—Ç–∞)

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ø–æ—á–µ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π:

- ‚úÖ –¶–µ–ø–æ—á–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤: `name|trim|upper`
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏: `text|slice(0, 5)`
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Å `and`
- ‚úÖ –°–ª–æ–∂–Ω—ã–µ —É—Å–ª–æ–≤–∏—è —Å `or`

**–ü—Ä–∏–º–µ—Ä—ã**:
```twig
{% if name|trim|upper == "JOHN" %}Match{% endif %}
{% if users|length > 0 and name|upper == "ADMIN" %}OK{% endif %}
{% if items|length > 10 or status|upper == "ACTIVE" %}Show{% endif %}
```

### 3. Filters in ELSEIF conditions (2 —Ç–µ—Å—Ç–∞)

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ `elseif`:

- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –≤ elseif
- ‚úÖ –†–∞–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –≤ if –∏ elseif

**–ü—Ä–∏–º–µ—Ä—ã**:
```twig
{% if count|length > 10 %}Many
{% elseif count|length > 5 %}Some
{% else %}Few
{% endif %}
```

### 4. Edge cases for filters in conditions (4 —Ç–µ—Å—Ç–∞)

–ì—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏:

- ‚úÖ –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
- ‚úÖ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (`>=`, `<=`, `!=`)
- ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã –≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏

**–ü—Ä–∏–º–µ—Ä—ã**:
```twig
{% if items|length == 0 %}Empty{% endif %}
{% if price|abs >= 100 %}Expensive{% endif %}
{% if users|length > 0 %}
    {% if users|first|upper == "ADMIN" %}Admin first{% endif %}
{% endif %}
```

### 5. Parenthesized expressions with filters (2 —Ç–µ—Å—Ç–∞)

–§–∏–ª—å—Ç—Ä—ã –≤ —Å–∫–æ–±–∫–∞—Ö –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:

- ‚úÖ –§–∏–ª—å—Ç—Ä –≤ —Å–∫–æ–±–∫–∞—Ö: `(items|length) > 5`
- ‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—Ä—ã**:
```twig
{% if (items|length) > 5 %}Many{% endif %}
{% if name1|upper == name2|upper %}Same{% endif %}
```

### 6. Real-world use cases (4 —Ç–µ—Å—Ç–∞)

–†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–æ—Å—Ç–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è email
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- ‚úÖ –†–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ —Ä–∞–∑–º–µ—Ä—É –º–∞—Å—Å–∏–≤–∞

**–ü—Ä–∏–º–µ—Ä—ã**:
```twig
{% if posts|length > 0 %}
    {{ posts|length }} posts found
{% else %}
    No posts
{% endif %}

{% if users|length == 0 %}No users
{% elseif users|length == 1 %}One user
{% else %}{{ users|length }} users
{% endif %}
```

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —É—Å–ª–æ–≤–∏—è—Ö
php vendor/bin/pest tests/Unit/Core/Template/TemplateEngineFiltersInConditionsTest.php

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
php vendor/bin/pest tests/Unit/Core/Template/TemplateEngineFiltersInConditionsTest.php --verbose

# –¢–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞
php vendor/bin/pest --filter="Filters in IF conditions"
```

## –ü–æ–∫—Ä—ã—Ç–∏–µ

**–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤**: 24

–ü–æ–∫—Ä—ã–≤–∞–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- ‚úÖ –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã (upper, lower, trim, length, count, first, last, abs)
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ (slice)
- ‚úÖ –¶–µ–ø–æ—á–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- ‚úÖ –£—Å–ª–æ–≤–∏—è if/elseif/else
- ‚úÖ –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã (and, or)
- ‚úÖ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è (>, <, ==, !=, >=, <=)
- ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ use cases

## –ß—Ç–æ –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

### ‚ùå –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

**–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```twig
{% if items|length + 5 > 10 %}...{% endif %}
{% if items|length - 2 > 0 %}...{% endif %}
{% if number|abs * 2 > 20 %}...{% endif %}
```

**–†–µ—à–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
```php
// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
$itemsCountPlusFive = count($items) + 5;

// –í —à–∞–±–ª–æ–Ω–µ
{% if itemsCountPlusFive > 10 %}...{% endif %}
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫–æ–±–∫–∏ –∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É –≤–Ω–µ —Ñ–∏–ª—å—Ç—Ä–∞:
```twig
{% set length = items|length %}
{% if length + 5 > 10 %}...{% endif %}
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ

```php
'/\b([a-zA-Z_][a-zA-Z0-9_\.]*(?:\[[^\]]+\])*)(\|[a-zA-Z_][a-zA-Z0-9_]*(?:\([^)]*\))?(?:\|[a-zA-Z_][a-zA-Z0-9_]*(?:\([^)]*\))?)*)(?=\s*(?:[<>=!+\-*\/]|\band\b|\bor\b|$))/i'
```

**–ß—Ç–æ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç**:
1. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è: `[a-zA-Z_][a-zA-Z0-9_\.]*(?:\[[^\]]+\])*`
2. –¶–µ–ø–æ—á–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤: `\|filter` –∏–ª–∏ `\|filter(args)`
3. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–¥: –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è, –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏, –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏

### –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏

1. **–ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–æ–∫** - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä–æ–∫–∏ –≤ –∫–∞–≤—ã—á–∫–∞—Ö
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤** - –∏—â–µ–º –∏ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ–º `variable|filter`
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤** - is defined, is null, etc.
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ in/not in**
5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤**
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**
7. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

## –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫ –∏ —Ä–µ—à–µ–Ω–∏–π

### –û—à–∏–±–∫–∞: "Filter 'length + 5' not found"

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫—É —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–ª–∏ –¥–µ–ª–∞–π—Ç–µ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
```twig
{# –ü–ª–æ—Ö–æ #}
{% if items|length + 5 > 10 %}...{% endif %}

{# –•–æ—Ä–æ—à–æ #}
{% set count = items|length %}
{% if count + 5 > 10 %}...{% endif %}
```

### –û—à–∏–±–∫–∞: "Unsupported operand types: string | bool"

**–ü—Ä–∏—á–∏–Ω–∞**: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–∞–π–ø–∞ —Ñ–∏–ª—å—Ç—Ä–∞ —Å –ª–æ–≥–∏—á–µ—Å–∫–∏–º OR (`|`)

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `or` –≤–º–µ—Å—Ç–æ `|` –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
```twig
{# –ü–ª–æ—Ö–æ #}
{% if a | b %}...{% endif %}

{# –•–æ—Ä–æ—à–æ #}
{% if a or b %}...{% endif %}
```

## Best Practices

### ‚úÖ –î–µ–ª–∞–π—Ç–µ

```twig
{# –ü—Ä–æ—Å—Ç—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã #}
{% if users|length > 0 %}...{% endif %}

{# –¶–µ–ø–æ—á–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ #}
{% if name|trim|upper == "ADMIN" %}...{% endif %}

{# –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã #}
{% if users|length > 0 and status|upper == "ACTIVE" %}...{% endif %}

{# –í–ª–æ–∂–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è #}
{% if items|length > 0 %}
    {% if items|first == "important" %}...{% endif %}
{% endif %}
```

### ‚ùå –ù–µ –¥–µ–ª–∞–π—Ç–µ

```twig
{# –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞ #}
{% if items|length + 5 > 10 %}...{% endif %}

{# –õ–æ–≥–∏—á–µ—Å–∫–æ–µ –ò–õ–ò —á–µ—Ä–µ–∑ –ø–∞–π–ø #}
{% if a|b %}...{% endif %}

{# –°–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è #}
{% if (a|filter1) * (b|filter2) + c > 10 %}...{% endif %}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–ª—É—á–∞–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —É—Å–ª–æ–≤–∏—è—Ö –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç:

- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –±–∞–∑–æ–≤—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫—É —Ü–µ–ø–æ—á–µ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- ‚úÖ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö

**24 —Ç–µ—Å—Ç–∞** –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞! üéâ

