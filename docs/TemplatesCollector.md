# Templates Collector - ะะพะปะปะตะบัะพั ะพััะตะฝะดะตัะตะฝะฝัั ัะฐะฑะปะพะฝะพะฒ

## ะะฑะทะพั

**TemplatesCollector** ะพัะพะฑัะฐะถะฐะตั ะธะฝัะพัะผะฐัะธั ะพะฑะพ ะฒัะตั ะพััะตะฝะดะตัะตะฝะฝัั ัะฐะฑะปะพะฝะฐั ะฒะพ ะฒัะตะผั ัะตะบััะตะณะพ ะทะฐะฟัะพัะฐ.

## ะะพะทะผะพะถะฝะพััะธ

### ๐ ะงัะพ ะฟะพะบะฐะทัะฒะฐะตั:
- ะกะฟะธัะพะบ ะฒัะตั ะพััะตะฝะดะตัะตะฝะฝัั ัะฐะฑะปะพะฝะพะฒ
- ะัะตะผั ัะตะฝะดะตัะธะฝะณะฐ ะบะฐะถะดะพะณะพ ัะฐะฑะปะพะฝะฐ
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะฐะผััะธ
- ะะฐะทะผะตั output
- ะกะฟะธัะพะบ ะฟะตัะตะดะฐะฝะฝัั ะฟะตัะตะผะตะฝะฝัั
- **Undefined ะฟะตัะตะผะตะฝะฝัะต** โ๏ธ
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะบััะฐ

### ๐จ ะะธะทัะฐะปะธะทะฐัะธั:
- **ะกัะฐัะธััะธะบะฐ** - ะพะฑัะฐั ะธะฝัะพัะผะฐัะธั
- **Undefined Variables** - ะฟัะตะดัะฟัะตะถะดะตะฝะธั
- **ะะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั** ะฟะพ ะบะฐะถะดะพะผั ัะฐะฑะปะพะฝั
- **ะฆะฒะตัะพะฒะฐั ะบะพะดะธัะพะฒะบะฐ** ะฟะพ ะฒัะตะผะตะฝะธ ัะตะฝะดะตัะธะฝะณะฐ

## ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะะฐะทะพะฒัะน ัะตะฝะดะตัะธะฝะณ

```php
use Core\TemplateEngine;

$engine = TemplateEngine::getInstance();

// ะะตะฝะดะตัะธะฝะณ ัะฐะฑะปะพะฝะฐ
$engine->render('welcome.twig', [
    'title' => 'Welcome',
    'user' => $userData,
    'posts' => $posts
]);
```

### ะก display()

```php
// ะะตะฝะดะตัะธะฝะณ ะธ ะฒัะฒะพะด
$engine->display('welcome.twig', [
    'title' => 'Welcome',
    'message' => 'Hello World'
]);
```

## ะะธะทัะฐะปัะฝะพะต ะพัะพะฑัะฐะถะตะฝะธะต

### ะกัะฐัะธััะธะบะฐ
```
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโ
โ TEMPLATES  โ TOTAL TIME  โ OUTPUT SIZE  โ FROM CACHE     โ
โ     3      โ   18.5 ms   โ    15.4 KB   โ     67%        โ
โโโโโโโโโโโโโโดโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโ
```

### Undefined Variables (ะตัะปะธ ะตััั)
```
โ๏ธ Undefined Variables (2)

$username (3 times)
$email (1 times)
```

### ะะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั ะพ ัะฐะฑะปะพะฝะต
```
๐ welcome.twig                           [5.2 ms] [๐๏ธ CACHED]

Variables: 5    Memory: 2.1 KB    Size: 8.3 KB

View Variables (5) โผ
  title, message, user, posts, meta
```

## ะฆะฒะตัะพะฒะฐั ะบะพะดะธัะพะฒะบะฐ ะฒัะตะผะตะฝะธ

- ๐ข **< 20ms** - ะฑััััะพ, ะทะตะปะตะฝัะน
- ๐ **20-50ms** - ััะตะดะฝะต, ะพัะฐะฝะถะตะฒัะน
- ๐ด **> 50ms** - ะผะตะดะปะตะฝะฝะพ, ะบัะฐัะฝัะน

## Undefined Variables

Templates Collector ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพััะปะตะถะธะฒะฐะตั undefined ะฟะตัะตะผะตะฝะฝัะต ะฒ ัะฐะฑะปะพะฝะฐั:

```tpl
<!-- welcome.twig -->
<h1>{{ title }}</h1>
<p>Hello, {{ username }}</p>  <!-- username ะฝะต ะฟะตัะตะดะฐะฝ! -->
```

ะ toolbar ะฒั ัะฒะธะดะธัะต ะฟัะตะดัะฟัะตะถะดะตะฝะธะต:
```
โ๏ธ Undefined Variables (1)
$username (1 times)
```

## Header Stats

ะ ะทะฐะณะพะปะพะฒะบะต toolbar:
- **ะัะธ undefined vars:** `๐จ 2 undefined vars` (ะพัะฐะฝะถะตะฒัะน)
- **ะะตะท ะฟัะพะฑะปะตะผ:** `๐จ 3 templates (18.5ms)` (ะทะตะปะตะฝัะน/ะพัะฐะฝะถะตะฒัะน/ะบัะฐัะฝัะน)

## Badge

ะะฐ ะฒะบะปะฐะดะบะต:
- ะะพะปะธัะตััะฒะพ undefined ะฟะตัะตะผะตะฝะฝัั (ะฟัะธะพัะธัะตั)
- ะะพะปะธัะตััะฒะพ ัะฐะฑะปะพะฝะพะฒ (ะตัะปะธ ะฝะตั undefined)

## API

### TemplateEngine::getRenderedTemplates()
```php
$templates = TemplateEngine::getRenderedTemplates();
// [
//     [
//         'template' => 'welcome.twig',
//         'path' => '/path/to/welcome.twig',
//         'variables' => ['title', 'message'],
//         'variables_count' => 2,
//         'time' => 15.2,  // ms
//         'memory' => 2048,  // bytes
//         'size' => 8192,  // bytes
//         'from_cache' => true
//     ],
//     ...
// ]
```

### TemplateEngine::getRenderStats()
```php
$stats = TemplateEngine::getRenderStats();
// [
//     'total' => 3,
//     'total_time' => 45.5,  // ms
//     'total_memory' => 6144,
//     'total_size' => 24576,
//     'from_cache' => 2,
//     'compiled' => 1
// ]
```

### TemplateEngine::getUndefinedVars()
```php
$undefined = TemplateEngine::getUndefinedVars();
// [
//     'username' => [
//         'count' => 3,
//         'message' => 'Undefined variable $username',
//         'file' => 'welcome.twig',
//         'line' => 15
//     ]
// ]
```

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะฟัะธะผะธะทะฐัะธั ัะตะฝะดะตัะธะฝะณะฐ

ะัะฟะพะปัะทัะนัะต Templates Collector ะดะปั ะฟะพะธัะบะฐ ะผะตะดะปะตะฝะฝัั ัะฐะฑะปะพะฝะพะฒ:

```php
// ะัะปะธ ัะฐะฑะปะพะฝ ะผะตะดะปะตะฝะฝัะน (> 50ms), ะพะฟัะธะผะธะทะธััะนัะต:
// 1. ะัะฟะพะปัะทัะนัะต ะบัั
// 2. ะฃะฟัะพััะธัะต ะปะพะณะธะบั ะฒ ัะฐะฑะปะพะฝะต
// 3. ะะธะฝะธะผะธะทะธััะนัะต ะบะพะปะธัะตััะฒะพ ัะธะบะปะพะฒ
```

### ะัะปะฐะดะบะฐ undefined ะฟะตัะตะผะตะฝะฝัั

```php
// ะ ะบะพะฝััะพะปะปะตัะต
$engine->display('user-profile.twig', [
    'user' => $user,
    'posts' => $posts,
    // 'stats' => $stats  // ะะฐะฑัะปะธ ะฟะตัะตะดะฐัั!
]);

// Templates Collector ะฟะพะบะฐะถะตั:
// โ๏ธ Undefined Variables (1): $stats
```

### ะะพะฝะธัะพัะธะฝะณ ะบััะฐ

ะกะปะตะดะธัะต ะทะฐ ะฟัะพัะตะฝัะพะผ ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะบััะฐ:
- **< 50%** - ะฟะปะพัะพ, ะบัั ะฝะต ะธัะฟะพะปัะทัะตััั
- **50-80%** - ะฝะพัะผะฐะปัะฝะพ
- **> 80%** - ะพัะปะธัะฝะพ, ะฑะพะปััะธะฝััะฒะพ ัะฐะฑะปะพะฝะพะฒ ะธะท ะบััะฐ

## ะะฝัะตะณัะฐัะธั

TemplatesCollector ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะตะณะธัััะธััะตััั ะฒ Debug Toolbar.

ะัะธะพัะธัะตั: **72** (ะผะตะถะดั Cache ะธ Timers)

## ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- โ ะะธะฝะธะผะฐะปัะฝะพะต ะฒะปะธัะฝะธะต (~0.5-1ms overhead)
- โ ะะฐะฝะฝัะต ัะพะฑะธัะฐัััั ัะพะปัะบะพ ะฒ debug ัะตะถะธะผะต
- โ ะะต ะฒะปะธัะตั ะฝะฐ production

## ะััะธัะพะฒะฐะฝะธะต

TemplateEngine ะบััะธััะตั ัะบะพะผะฟะธะปะธัะพะฒะฐะฝะฝัะต ัะฐะฑะปะพะฝั:

```php
// ะะบะปััะธัั ะบัั (ะฟะพ ัะผะพะปัะฐะฝะธั ะฒะบะปััะตะฝ)
$engine->setCacheEnabled(true);

// ะฃััะฐะฝะพะฒะธัั ะฒัะตะผั ะถะธะทะฝะธ
$engine->setCacheLifetime(3600); // 1 ัะฐั

// ะัะธััะธัั ะบัั
$engine->clearCache();
```

## ะกะพะฒะตัั

1. **ะกะปะตะดะธัะต ะทะฐ undefined ะฟะตัะตะผะตะฝะฝัะผะธ:**
   - ะัะตะณะดะฐ ะฟะตัะตะดะฐะฒะฐะนัะต ะฒัะต ะฝะตะพะฑัะพะดะธะผัะต ะฟะตัะตะผะตะฝะฝัะต
   - ะัะฟะพะปัะทัะนัะต default values ะฒ ัะฐะฑะปะพะฝะฐั

2. **ะะฟัะธะผะธะทะธััะนัะต ะผะตะดะปะตะฝะฝัะต ัะฐะฑะปะพะฝั:**
   - ะัะฝะพัะธัะต ัะปะพะถะฝัั ะปะพะณะธะบั ะฒ ะบะพะฝััะพะปะปะตั
   - ะะธะฝะธะผะธะทะธััะนัะต ะฒะปะพะถะตะฝะฝัะต ัะธะบะปั
   - ะัะฟะพะปัะทัะนัะต ะบัั

3. **ะัะพะฒะตััะนัะต ัะฐะทะผะตั output:**
   - ะะพะปััะธะต ัะฐะฑะปะพะฝั (> 100KB) - ะบะฐะฝะดะธะดะฐัั ะฝะฐ ะพะฟัะธะผะธะทะฐัะธั
   - ะะฐััะผะพััะธัะต pagination ะธะปะธ lazy loading

4. **ะัะฟะพะปัะทัะนัะต ะบัั:**
   - ะะบะปััะฐะนัะต ะบัั ะฒ production
   - ะัะธัะฐะนัะต ะบัั ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ัะฐะฑะปะพะฝะพะฒ

## ะงัะพ ะดะฐะปััะต?

ะกะปะตะดัััะธะต ะฒะพะทะผะพะถะฝะพััะธ:
- Waterfall chart ะดะปั nested templates
- ะะตัะฐะปัะฝัะน ะฐะฝะฐะปะธะท undefined ะฟะตัะตะผะตะฝะฝัั
- ะกัะฐะฒะฝะตะฝะธะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ ัะฐะฑะปะพะฝะพะฒ
- ะะตะบะพะผะตะฝะดะฐัะธะธ ะฟะพ ะพะฟัะธะผะธะทะฐัะธะธ


